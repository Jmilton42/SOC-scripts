DPKG() {

  apt install -y make gcc autoconf libtool libssl-dev pkg-config jq
  curl -LO https://github.com/VirusTotal/yara/archive/v4.5.5.tar.gz || wget https://github.com/VirusTotal/yara/archive/v4.5.5.tar.gz || fetch https://github.com/VirusTotal/yara/archive/v4.5.5.tar.gz
  tar -xvzf v4.5.5.tar.gz -C /usr/local/bin/ && rm -f v4.5.5.tar.gz
  cd /usr/local/bin/yara-4.5.5/
  ./bootstrap.sh && ./configure && make && make install && make check

  echo "/usr/local/lib" >> /etc/ld.so.conf
  ldconfig

}

RPM() {
  yum install -y make gcc autoconf libtool openssl-devel pkgconfig jq
  curl -LO https://github.com/VirusTotal/yara/archive/v4.5.5.tar.gz || wget https://github.com/VirusTotal/yara/archive/v4.5.5.tar.gz || fetch https://github.com/VirusTotal/yara/archive/v4.5.5.tar.gz
  tar -xvzf v4.5.5.tar.gz -C /usr/local/bin/ && rm -f v4.5.5.tar.gz
  cd /usr/local/bin/yara-4.5.5/
  ./bootstrap.sh && ./configure && make && make install && make check
}

DOWNLOAD_YARA() {
  sudo mkdir -p /tmp/yara/rules
  sudo curl 'https://valhalla.nextron-systems.com/api/v1/get' \
  -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8' \
  -H 'Accept-Language: en-US,en;q=0.5' \
  --compressed \
  -H 'Referer: https://valhalla.nextron-systems.com/' \
  -H 'Content-Type: application/x-www-form-urlencoded' \
  -H 'DNT: 1' -H 'Connection: keep-alive' -H 'Upgrade-Insecure-Requests: 1' \
  --data 'demo=demo&apikey=1111111111111111111111111111111111111111111111111111111111111111&format=text' \
  -o /tmp/yara/rules/yara_rules.yar
}

if command -v dpkg >/dev/null ; then
  DPKG
elif command -v rpm >/dev/null ; then
  RPM
else
  echo "ERROR: Unsupported package manager."
  exit 1
fi